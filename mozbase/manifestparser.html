

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Managing lists of tests &mdash; Mozilla Source Tree Docs 59.0a1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Mozilla Source Tree Docs 59.0a1 documentation" href="../index.html"/>
        <link rel="up" title="mozbase" href="index.html"/>
        <link rel="next" title="Getting information on the system under test" href="gettinginfo.html"/>
        <link rel="prev" title="mozbase" href="index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Mozilla Source Tree Docs
          

          
          </a>

          
            
            
              <div class="version">
                59.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../browser/base/sslerrorreport/index.html">SSL Error Reporting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../browser/browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../browser/experiments/experiments/index.html">Telemetry Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gfx/gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mobile/android/fennec/index.html">Firefox for Android</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mobile/android/fennec/index.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">mozbase</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Managing lists of tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#manifestparser-create-and-manage-test-manifests"><code class="docutils literal"><span class="pre">manifestparser</span></code> — Create and manage test manifests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#why-have-test-manifests">Why have test manifests?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#manifest-format">Manifest Format</a></li>
<li class="toctree-l4"><a class="reference internal" href="#special-variable-server-root">Special variable server-root</a></li>
<li class="toctree-l4"><a class="reference internal" href="#manifest-conditional-expressions">Manifest Conditional Expressions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data">Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#manifestparser-architecture">manifestparser Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="#filtering-manifests">Filtering Manifests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-manifests">Creating Manifests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#copying-manifests">Copying Manifests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#updating-tests">Updating Tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage-example">Usage example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">Creating Manifests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#updating-the-tests-from-manifests">Updating the tests from manifests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tests">Tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bugs">Bugs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cli">CLI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#design-considerations">Design Considerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#historical-reference">Historical Reference</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="gettinginfo.html">Getting information on the system under test</a></li>
<li class="toctree-l2"><a class="reference internal" href="setuprunning.html">Set up and running</a></li>
<li class="toctree-l2"><a class="reference internal" href="mozhttpd.html">Serving up content to be consumed by the browser</a></li>
<li class="toctree-l2"><a class="reference internal" href="loggingreporting.html">Logging and reporting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/mach/index.html">mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../taskcluster/taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/geckodriver/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testing/marionette/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../toolkit/components/crashes/crash-manager/index.html">Crash Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../toolkit/components/extensions/webextensions/index.html">WebExtensions API Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../toolkit/components/payments/docs/index.html">WebPayments UI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../toolkit/components/telemetry/telemetry/index.html">Telemetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../toolkit/components/url-classifier/url-classifier/index.html">URL Classifier</a></li>
<li class="toctree-l1"><a class="reference internal" href="../toolkit/crashreporter/crashreporter/index.html">Crash Reporter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../toolkit/modules/subprocess/toolkit_modules/subprocess/index.html">Supbrocess Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../toolkit/modules/toolkit_modules/index.html">Toolkit modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../toolkit/mozapps/extensions/addon-manager/index.html">Add-on Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/compare-locales/index.html">Localization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/lint/index.html">Linting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/lint/index.html#indices-and-tables">Indices and tables</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python/mach.html">mach package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/mozbuild.html">mozbuild package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/mozlint.html">mozlint package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/mozpack.html">mozpack package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/mozversioncontrol.html">mozversioncontrol package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/mozwebidlcodegen.html">mozwebidlcodegen package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/taskgraph.html">taskgraph package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Mozilla Source Tree Docs</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">mozbase</a> &raquo;</li>
        
      <li>Managing lists of tests</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/mozbase/manifestparser.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="managing-lists-of-tests">
<h1>Managing lists of tests<a class="headerlink" href="#managing-lists-of-tests" title="Permalink to this headline">¶</a></h1>
<p>We don’t always want to run all tests, all the time. Sometimes a test
may be broken, in other cases we only want to run a test on a specific
platform or build of Mozilla. To handle these cases (and more), we
created a python library to create and use test “manifests”, which
codify this information.</p>
<div class="section" id="manifestparser-create-and-manage-test-manifests">
<h2><code class="xref py py-mod docutils literal"><span class="pre">manifestparser</span></code> — Create and manage test manifests<a class="headerlink" href="#manifestparser-create-and-manage-test-manifests" title="Permalink to this headline">¶</a></h2>
<p>manifestparser lets you easily create and use test manifests, to
control which tests are run under what circumstances.</p>
<p>What manifestparser gives you:</p>
<ul class="simple">
<li>manifests are ordered lists of tests</li>
<li>tests may have an arbitrary number of key, value pairs</li>
<li>the parser returns an ordered list of test data structures, which
are just dicts with some keys.  For example, a test with no
user-specified metadata looks like this:</li>
</ul>
<div class="highlight-text"><div class="highlight"><pre><span></span>[{&#39;expected&#39;: &#39;pass&#39;,
  &#39;path&#39;: &#39;/home/mozilla/mozmill/src/manifestparser/manifestparser/tests/testToolbar/testBackForwardButtons.js&#39;,
  &#39;relpath&#39;: &#39;testToolbar/testBackForwardButtons.js&#39;,
  &#39;name&#39;: &#39;testBackForwardButtons.js&#39;,
  &#39;here&#39;: &#39;/home/mozilla/mozmill/src/manifestparser/manifestparser/tests&#39;,
  &#39;manifest&#39;: &#39;/home/mozilla/mozmill/src/manifestparser/manifestparser/tests/manifest.ini&#39;,}]
</pre></div>
</div>
<p>The keys displayed here (path, relpath, name, here, and manifest) are
reserved keys for manifestparser and any consuming APIs.  You can add
additional key, value metadata to each test.</p>
<div class="section" id="why-have-test-manifests">
<h3>Why have test manifests?<a class="headerlink" href="#why-have-test-manifests" title="Permalink to this headline">¶</a></h3>
<p>It is desirable to have a unified format for test manifests for testing
[mozilla-central](<a class="reference external" href="http://hg.mozilla.org/mozilla-central">http://hg.mozilla.org/mozilla-central</a>), etc.</p>
<ul class="simple">
<li>It is desirable to be able to selectively enable or disable tests based on platform or other conditions. This should be easy to do. Currently, since many of the harnesses just crawl directories, there is no effective way of disabling a test except for removal from mozilla-central</li>
<li>It is desriable to do this in a universal way so that enabling and disabling tests as well as other tasks are easily accessible to a wider audience than just those intimately familiar with the specific test framework.</li>
<li>It is desirable to have other metadata on top of the test. For instance, let’s say a test is marked as skipped. It would be nice to give the reason why.</li>
</ul>
<p>Most Mozilla test harnesses work by crawling a directory structure.
While this is straight-forward, manifests offer several practical
advantages:</p>
<ul class="simple">
<li>ability to turn a test off easily: if a test is broken on m-c
currently, the only way to turn it off, generally speaking, is just
removing the test.  Often this is undesirable, as if the test should
be dismissed because other people want to land and it can’t be
investigated in real time (is it a failure? is the test bad? is no
one around that knows the test?), then backing out a test is at best
problematic.  With a manifest, a test may be disabled without
removing it from the tree and a bug filed with the appropriate
reason:</li>
</ul>
<div class="highlight-text"><div class="highlight"><pre><span></span>[test_broken.js]
disabled = https://bugzilla.mozilla.org/show_bug.cgi?id=123456
</pre></div>
</div>
<ul class="simple">
<li>ability to run different (subsets of) tests on different
platforms. Traditionally, we’ve done a bit of magic or had the test
know what platform it would or would not run on. With manifests, you
can mark what platforms a test will or will not run on and change
these without changing the test.</li>
</ul>
<div class="highlight-text"><div class="highlight"><pre><span></span>[test_works_on_windows_only.js]
skip-if = os != &#39;win&#39;
</pre></div>
</div>
<ul class="simple">
<li>ability to markup tests with metadata. We have a large, complicated,
and always changing infrastructure.  key, value metadata may be used
as an annotation to a test and appropriately curated and mined.  For
instance, we could mark certain tests as randomorange with a bug
number, if it were desirable.</li>
<li>ability to have sane and well-defined test-runs. You can keep
different manifests for different test runs and <code class="docutils literal"><span class="pre">[include:]</span></code>
(sub)manifests as appropriate to your needs.</li>
</ul>
</div>
<div class="section" id="manifest-format">
<h3>Manifest Format<a class="headerlink" href="#manifest-format" title="Permalink to this headline">¶</a></h3>
<p>Manifests are .ini file with the section names denoting the path
relative to the manifest:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>[foo.js]
[bar.js]
[fleem.js]
</pre></div>
</div>
<p>The sections are read in order. In addition, tests may include
arbitrary key, value metadata to be used by the harness.  You may also
have a <cite>[DEFAULT]</cite> section that will give key, value pairs that will
be inherited by each test unless overridden:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>[DEFAULT]
type = restart

[lilies.js]
color = white

[daffodils.js]
color = yellow
type = other
# override type from DEFAULT

[roses.js]
color = red
</pre></div>
</div>
<p>You can also include other manifests:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>[include:subdir/anothermanifest.ini]
</pre></div>
</div>
<p>And reference parent manifests to inherit keys and values from the DEFAULT
section, without adding possible included tests.</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>[parent:../manifest.ini]
</pre></div>
</div>
<p>Manifests are included relative to the directory of the manifest with
the <cite>[include:]</cite> directive unless they are absolute paths.</p>
<p>By default you can use ‘#’ as a comment character. Comments can start a
new line, or be inline.</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>[roses.js]
# a valid comment
color = red # another valid comment
</pre></div>
</div>
<p>Comment characters must be preceded by a space, or they will not be
treated as comments.</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>[test1.js]
url = https://foo.com/bar#baz
</pre></div>
</div>
<p>The ‘#baz’ anchor will not be stripped off, as it wasn’t preceded by
a space.</p>
</div>
<div class="section" id="special-variable-server-root">
<h3>Special variable server-root<a class="headerlink" href="#special-variable-server-root" title="Permalink to this headline">¶</a></h3>
<p>There is a special variable called <cite>server-root</cite> used for paths on the system.
This variable is deemed a path and will be expanded into its absolute form.</p>
<p>Because of the inheritant nature of the key/value pairs, if one requires a
system path, it must be absolute for it to be of any use in any included file.</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>[DEFAULTS]
server-root = ../data

[test1.js]
server-root = test1/data
</pre></div>
</div>
</div>
<div class="section" id="manifest-conditional-expressions">
<h3>Manifest Conditional Expressions<a class="headerlink" href="#manifest-conditional-expressions" title="Permalink to this headline">¶</a></h3>
<p>The conditional expressions used in manifests are parsed using the <em>ExpressionParser</em> class.</p>
<dl class="class">
<dt id="manifestparser.ExpressionParser">
<em class="property">class </em><code class="descclassname">manifestparser.</code><code class="descname">ExpressionParser</code><span class="sig-paren">(</span><em>text</em>, <em>valuemapping</em>, <em>strict=False</em><span class="sig-paren">)</span><a class="headerlink" href="#manifestparser.ExpressionParser" title="Permalink to this definition">¶</a></dt>
<dd><p>A parser for a simple expression language.</p>
<p>The expression language can be described as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">EXPRESSION</span> <span class="p">::</span><span class="o">=</span> <span class="n">LITERAL</span> <span class="o">|</span> <span class="s1">&#39;(&#39;</span> <span class="n">EXPRESSION</span> <span class="s1">&#39;)&#39;</span> <span class="o">|</span> <span class="s1">&#39;!&#39;</span> <span class="n">EXPRESSION</span> <span class="o">|</span> <span class="n">EXPRESSION</span> <span class="n">OP</span> <span class="n">EXPRESSION</span>
<span class="n">OP</span> <span class="p">::</span><span class="o">=</span> <span class="s1">&#39;==&#39;</span> <span class="o">|</span> <span class="s1">&#39;!=&#39;</span> <span class="o">|</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">|</span> <span class="s1">&#39;&gt;&#39;</span> <span class="o">|</span> <span class="s1">&#39;&lt;=&#39;</span> <span class="o">|</span> <span class="s1">&#39;&gt;=&#39;</span> <span class="o">|</span> <span class="s1">&#39;&amp;&amp;&#39;</span> <span class="o">|</span> <span class="s1">&#39;||&#39;</span>
<span class="n">LITERAL</span> <span class="p">::</span><span class="o">=</span> <span class="n">BOOL</span> <span class="o">|</span> <span class="n">INT</span> <span class="o">|</span> <span class="n">IDENT</span> <span class="o">|</span> <span class="n">STRING</span>
<span class="n">BOOL</span> <span class="p">::</span><span class="o">=</span> <span class="s1">&#39;true&#39;</span> <span class="o">|</span> <span class="s1">&#39;false&#39;</span>
<span class="n">INT</span> <span class="p">::</span><span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span>
<span class="n">IDENT</span> <span class="p">::</span><span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z_</span><span class="p">]</span>\<span class="n">w</span><span class="o">*</span>
<span class="n">STRING</span> <span class="p">::</span><span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="p">[</span><span class="o">^</span><span class="s2">&quot;] &#39;&quot;</span><span class="s1">&#39; | &#39;&#39;&#39;</span> <span class="p">[</span><span class="o">^</span><span class="s1">&#39;] &#39;&#39;&#39;</span>
</pre></div>
</div>
<p>At its core, expressions consist of booleans, integers, identifiers and.
strings. Booleans are one of <em>true</em> or <em>false</em>. Integers are a series
of digits. Identifiers are a series of English letters and underscores.
Strings are a pair of matching quote characters (single or double) with
zero or more characters inside.</p>
<p>Expressions can be combined with operators: the equals (==) and not
equals (!=) operators compare two expressions and produce a boolean. The
and (&amp;&amp;) and or (||) operators take two expressions and produce the logical
AND or OR value of them, respectively. An expression can also be prefixed
with the not (!) operator, which produces its logical negation.</p>
<p>Finally, any expression may be contained within parentheses for grouping.</p>
<p>Identifiers take their values from the mapping provided.</p>
</dd></dl>

<p>Consumers of this module are expected to pass in a value dictionary
for evaluating conditional expressions. A common pattern is to pass
the dictionary from the <a class="reference internal" href="mozinfo.html#module-mozinfo" title="mozinfo"><code class="xref py py-mod docutils literal"><span class="pre">mozinfo</span></code></a> module.</p>
</div>
<div class="section" id="data">
<h3>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h3>
<p>Manifest Destiny gives tests as a list of dictionaries (in python
terms).</p>
<ul class="simple">
<li>path: full path to the test</li>
<li><dl class="first docutils">
<dt>relpath: relative path starting from the root directory. The root directory</dt>
<dd>is typically the location of the root manifest, or the source
repository. It can be specified at runtime by passing in <cite>rootdir</cite>
to <cite>TestManifest</cite>. Defaults to the directory containing the test’s
ancestor manifest.</dd>
</dl>
</li>
<li>name: file name of the test</li>
<li>here: the parent directory of the manifest</li>
<li>manifest: the path to the manifest containing the test</li>
</ul>
<p>This data corresponds to a one-line manifest:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>[testToolbar/testBackForwardButtons.js]
</pre></div>
</div>
<p>If additional key, values were specified, they would be in this dict
as well.</p>
<p>Outside of the reserved keys, the remaining key, values
are up to convention to use.  There is a (currently very minimal)
generic integration layer in manifestparser for use of all harnesses,
<cite>manifestparser.TestManifest</cite>.
For instance, if the ‘disabled’ key is present, you can get the set of
tests without disabled (various other queries are doable as well).</p>
<p>Since the system is convention-based, the harnesses may do whatever
they want with the data.  They may ignore it completely, they may use
the provided integration layer, or they may provide their own
integration layer.  This should allow whatever sort of logic is
desired.  For instance, if in yourtestharness you wanted to run only on
mondays for a certain class of tests:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>tests = []
for test in manifests.tests:
    if &#39;runOnDay&#39; in test:
       if calendar.day_name[calendar.weekday(*datetime.datetime.now().timetuple()[:3])].lower() == test[&#39;runOnDay&#39;].lower():
           tests.append(test)
    else:
       tests.append(test)
</pre></div>
</div>
<p>To recap:
* the manifests allow you to specify test data
* the parser gives you this data
* you can use it however you want or process it further as you need</p>
<p>Tests are denoted by sections in an .ini file (see
<a class="reference external" href="http://hg.mozilla.org/automation/manifestparser/file/tip/manifestparser/tests/mozmill-example.ini">http://hg.mozilla.org/automation/manifestparser/file/tip/manifestparser/tests/mozmill-example.ini</a>).</p>
<p>Additional manifest files may be included with an <cite>[include:]</cite> directive:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>[include:path-to-additional-file.manifest]
</pre></div>
</div>
<p>The path to included files is relative to the current manifest.</p>
<p>The <cite>[DEFAULT]</cite> section contains variables that all tests inherit from.</p>
<p>Included files will inherit the top-level variables but may override
in their own <cite>[DEFAULT]</cite> section.</p>
</div>
<div class="section" id="manifestparser-architecture">
<h3>manifestparser Architecture<a class="headerlink" href="#manifestparser-architecture" title="Permalink to this headline">¶</a></h3>
<p>There is a two- or three-layered approach to the manifestparser
architecture, depending on your needs:</p>
<p>1. ManifestParser: this is a generic parser for .ini manifests that
facilitates the <cite>[include:]</cite> logic and the inheritence of
metadata. Despite the internal variable being called <cite>self.tests</cite>
(an oversight), this layer has nothing in particular to do with tests.</p>
<p>2. TestManifest: this is a harness-agnostic integration layer that is
test-specific. TestManifest faciliates <cite>skip-if</cite> logic.</p>
<p>3. Optionally, a harness will have an integration layer than inherits
from TestManifest if more harness-specific customization is desired at
the manifest level.</p>
<p>See the source code at <a class="reference external" href="https://github.com/mozilla/mozbase/tree/master/manifestparser">https://github.com/mozilla/mozbase/tree/master/manifestparser</a>
and
<a class="reference external" href="https://github.com/mozilla/mozbase/blob/master/manifestparser/manifestparser.py">https://github.com/mozilla/mozbase/blob/master/manifestparser/manifestparser.py</a>
in particular.</p>
</div>
<div class="section" id="filtering-manifests">
<h3>Filtering Manifests<a class="headerlink" href="#filtering-manifests" title="Permalink to this headline">¶</a></h3>
<p>After creating a <cite>TestManifest</cite> object, all manifest files are read and a list
of test objects can be accessed via <cite>TestManifest.tests</cite>. However this list contains
all test objects, whether they should be run or not. Normally they need to be
filtered down only to the set of tests that should be run by the test harness.</p>
<p>To do this, a test harness can call <cite>TestManifest.active_tests</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">tests</span> <span class="o">=</span> <span class="n">manifest</span><span class="o">.</span><span class="n">active_tests</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">disabled</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">tags</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, <cite>active_tests</cite> runs the filters found in
<code class="xref py py-attr docutils literal"><span class="pre">DEFAULT_FILTERS</span></code>. It also accepts two convenience arguments:</p>
<ol class="arabic simple">
<li><cite>exists</cite>: if True (default), filter out tests that do not exist on the local file system.</li>
<li><cite>disabled</cite>: if True (default), do not filter out tests containing the ‘disabled’ key
(which can be set by <cite>skip-if</cite> manually).</li>
</ol>
<p>This works for simple cases, but there are other built-in filters, or even custom filters
that can be applied to the <cite>TestManifest</cite>. To do so, add the filter to <cite>TestManifest.filters</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">manifestparser.filters</span> <span class="kn">import</span> <span class="n">subsuite</span>
<span class="kn">import</span> <span class="nn">mozinfo</span>

<span class="n">filters</span> <span class="o">=</span> <span class="p">[</span><span class="n">subsuite</span><span class="p">(</span><span class="s1">&#39;devtools&#39;</span><span class="p">)]</span>
<span class="n">tests</span> <span class="o">=</span> <span class="n">manifest</span><span class="o">.</span><span class="n">active_tests</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span> <span class="o">**</span><span class="n">mozinfo</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
</pre></div>
</div>
<span class="target" id="module-manifestparser.filters"></span><p>A filter is a callable that accepts an iterable of test objects and a
dictionary of values, and returns a new iterable of test objects. It is
possible to define custom filters if the built-in ones are not enough.</p>
<dl class="class">
<dt id="manifestparser.filters.chunk_by_dir">
<em class="property">class </em><code class="descclassname">manifestparser.filters.</code><code class="descname">chunk_by_dir</code><span class="sig-paren">(</span><em>this_chunk</em>, <em>total_chunks</em>, <em>depth</em><span class="sig-paren">)</span><a class="headerlink" href="#manifestparser.filters.chunk_by_dir" title="Permalink to this definition">¶</a></dt>
<dd><p>Basic chunking algorithm that splits directories of tests evenly at a
given depth.</p>
<p>For example, a depth of 2 means all test directories two path nodes away
from the base are gathered, then split evenly across the total number of
chunks. The number of tests in each of the directories is not taken into
account (so chunks will not contain an even number of tests). All test
paths must be relative to the same root (typically the root of the source
repository).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>this_chunk</strong> – the current chunk, 1 &lt;= this_chunk &lt;= total_chunks</li>
<li><strong>total_chunks</strong> – the total number of chunks</li>
<li><strong>depth</strong> – the minimum depth of a subdirectory before it will be
considered unique</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="manifestparser.filters.chunk_by_runtime">
<em class="property">class </em><code class="descclassname">manifestparser.filters.</code><code class="descname">chunk_by_runtime</code><span class="sig-paren">(</span><em>this_chunk</em>, <em>total_chunks</em>, <em>runtimes</em>, <em>default_runtime=0</em><span class="sig-paren">)</span><a class="headerlink" href="#manifestparser.filters.chunk_by_runtime" title="Permalink to this definition">¶</a></dt>
<dd><p>Chunking algorithm that attempts to group tests into chunks based on their
average runtimes. It keeps manifests of tests together and pairs slow
running manifests with fast ones.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>this_chunk</strong> – the current chunk, 1 &lt;= this_chunk &lt;= total_chunks</li>
<li><strong>total_chunks</strong> – the total number of chunks</li>
<li><strong>runtimes</strong> – dictionary of test runtime data, of the form
{&lt;test path&gt;: &lt;average runtime&gt;}</li>
<li><strong>default_runtime</strong> – value in seconds to assign tests that don’t exist
in the runtimes file</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="manifestparser.filters.chunk_by_slice">
<em class="property">class </em><code class="descclassname">manifestparser.filters.</code><code class="descname">chunk_by_slice</code><span class="sig-paren">(</span><em>this_chunk</em>, <em>total_chunks</em>, <em>disabled=False</em><span class="sig-paren">)</span><a class="headerlink" href="#manifestparser.filters.chunk_by_slice" title="Permalink to this definition">¶</a></dt>
<dd><p>Basic chunking algorithm that splits tests evenly across total chunks.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>this_chunk</strong> – the current chunk, 1 &lt;= this_chunk &lt;= total_chunks</li>
<li><strong>total_chunks</strong> – the total number of chunks</li>
<li><strong>disabled</strong> – Whether to include disabled tests in the chunking
algorithm. If False, each chunk contains an equal number
of non-disabled tests. If True, each chunk contains an
equal number of tests (default False)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="manifestparser.filters.enabled">
<code class="descclassname">manifestparser.filters.</code><code class="descname">enabled</code><span class="sig-paren">(</span><em>tests</em>, <em>values</em><span class="sig-paren">)</span><a class="headerlink" href="#manifestparser.filters.enabled" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes all tests containing the <cite>disabled</cite> key. This filter can be
added by passing <cite>disabled=False</cite> into <cite>active_tests</cite>.</p>
</dd></dl>

<dl class="function">
<dt id="manifestparser.filters.exists">
<code class="descclassname">manifestparser.filters.</code><code class="descname">exists</code><span class="sig-paren">(</span><em>tests</em>, <em>values</em><span class="sig-paren">)</span><a class="headerlink" href="#manifestparser.filters.exists" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes all tests that do not exist on the file system. This filter is
added by default, but can be removed by passing <cite>exists=False</cite> into
<cite>active_tests</cite>.</p>
</dd></dl>

<dl class="function">
<dt id="manifestparser.filters.fail_if">
<code class="descclassname">manifestparser.filters.</code><code class="descname">fail_if</code><span class="sig-paren">(</span><em>tests</em>, <em>values</em><span class="sig-paren">)</span><a class="headerlink" href="#manifestparser.filters.fail_if" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets expected to ‘fail’ on all tests containing the <cite>fail-if</cite> tag and whose
condition is True. This filter is added by default.</p>
</dd></dl>

<dl class="class">
<dt id="manifestparser.filters.pathprefix">
<em class="property">class </em><code class="descclassname">manifestparser.filters.</code><code class="descname">pathprefix</code><span class="sig-paren">(</span><em>paths</em><span class="sig-paren">)</span><a class="headerlink" href="#manifestparser.filters.pathprefix" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes tests that don’t start with any of the given test paths.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>paths</strong> – A list of test paths to filter on</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="manifestparser.filters.run_if">
<code class="descclassname">manifestparser.filters.</code><code class="descname">run_if</code><span class="sig-paren">(</span><em>tests</em>, <em>values</em><span class="sig-paren">)</span><a class="headerlink" href="#manifestparser.filters.run_if" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets disabled on all tests containing the <cite>run-if</cite> tag and whose condition
is False. This filter is added by default.</p>
</dd></dl>

<dl class="function">
<dt id="manifestparser.filters.skip_if">
<code class="descclassname">manifestparser.filters.</code><code class="descname">skip_if</code><span class="sig-paren">(</span><em>tests</em>, <em>values</em><span class="sig-paren">)</span><a class="headerlink" href="#manifestparser.filters.skip_if" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets disabled on all tests containing the <cite>skip-if</cite> tag and whose condition
is True. This filter is added by default.</p>
</dd></dl>

<dl class="class">
<dt id="manifestparser.filters.subsuite">
<em class="property">class </em><code class="descclassname">manifestparser.filters.</code><code class="descname">subsuite</code><span class="sig-paren">(</span><em>name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#manifestparser.filters.subsuite" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>name</cite> is None, removes all tests that have a <cite>subsuite</cite> key.
Otherwise removes all tests that do not have a subsuite matching <cite>name</cite>.</p>
<dl class="docutils">
<dt>It is possible to specify conditional subsuite keys using:</dt>
<dd>subsuite = foo,condition</dd>
</dl>
<p>where ‘foo’ is the subsuite name, and ‘condition’ is the same type of
condition used for skip-if.  If the condition doesn’t evaluate to true,
the subsuite designation will be removed from the test.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>name</strong> – The name of the subsuite to run (default None)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="manifestparser.filters.tags">
<em class="property">class </em><code class="descclassname">manifestparser.filters.</code><code class="descname">tags</code><span class="sig-paren">(</span><em>tags</em><span class="sig-paren">)</span><a class="headerlink" href="#manifestparser.filters.tags" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes tests that don’t contain any of the given tags. This overrides
InstanceFilter’s __eq__ method, so multiple instances can be added.
Multiple tag filters is equivalent to joining tags with the AND operator.</p>
<p>To define a tag in a manifest, add a <cite>tags</cite> attribute to a test or DEFAULT
section. Tests can have multiple tags, in which case they should be
whitespace delimited. For example:</p>
<p>[test_foobar.html]
tags = foo bar</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>tags</strong> – A tag or list of tags to filter tests on</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="data">
<dt id="manifestparser.filters.DEFAULT_FILTERS">
<code class="descclassname">manifestparser.filters.</code><code class="descname">DEFAULT_FILTERS</code><a class="headerlink" href="#manifestparser.filters.DEFAULT_FILTERS" title="Permalink to this definition">¶</a></dt>
<dd><p>By default <code class="xref py py-func docutils literal"><span class="pre">active_tests()</span></code> will run the <a class="reference internal" href="#manifestparser.filters.skip_if" title="manifestparser.filters.skip_if"><code class="xref py py-func docutils literal"><span class="pre">skip_if()</span></code></a>,
<a class="reference internal" href="#manifestparser.filters.run_if" title="manifestparser.filters.run_if"><code class="xref py py-func docutils literal"><span class="pre">run_if()</span></code></a> and <a class="reference internal" href="#manifestparser.filters.fail_if" title="manifestparser.filters.fail_if"><code class="xref py py-func docutils literal"><span class="pre">fail_if()</span></code></a> filters.</p>
</dd></dl>

<p>For example, suppose we want to introduce a new key called <cite>timeout-if</cite> that adds a
‘timeout’ property to a test if a certain condition is True. The syntax in the manifest
files will look like this:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>[test_foo.py]
timeout-if = 300, os == &#39;win&#39;
</pre></div>
</div>
<p>The value is &lt;timeout&gt;, &lt;condition&gt; where condition is the same format as the one in
<cite>skip-if</cite>. In the above case, if os == ‘win’, a timeout of 300 seconds will be
applied. Otherwise, no timeout will be applied. All we need to do is define the filter
and add it:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">manifestparser.expression</span> <span class="kn">import</span> <span class="n">parse</span>
<span class="kn">import</span> <span class="nn">mozinfo</span>

<span class="k">def</span> <span class="nf">timeout_if</span><span class="p">(</span><span class="n">tests</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;timeout-if&#39;</span> <span class="ow">in</span> <span class="n">test</span><span class="p">:</span>
            <span class="n">timeout</span><span class="p">,</span> <span class="n">condition</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;timeout-if&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parse</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="o">**</span><span class="n">values</span><span class="p">):</span>
                <span class="n">test</span><span class="p">[</span><span class="s1">&#39;timeout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="k">yield</span> <span class="n">test</span>

<span class="n">tests</span> <span class="o">=</span> <span class="n">manifest</span><span class="o">.</span><span class="n">active_tests</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="n">timeout_if</span><span class="p">],</span> <span class="o">**</span><span class="n">mozinfo</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-manifests">
<h3>Creating Manifests<a class="headerlink" href="#creating-manifests" title="Permalink to this headline">¶</a></h3>
<p>manifestparser comes with a console script, <cite>manifestparser create</cite>, that
may be used to create a seed manifest structure from a directory of
files.  Run <cite>manifestparser help create</cite> for usage information.</p>
</div>
<div class="section" id="copying-manifests">
<h3>Copying Manifests<a class="headerlink" href="#copying-manifests" title="Permalink to this headline">¶</a></h3>
<p>To copy tests and manifests from a source:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>manifestparser [options] copy from_manifest to_directory -tag1 -tag2 `key1=value1 key2=value2 ...
</pre></div>
</div>
</div>
<div class="section" id="updating-tests">
<h3>Updating Tests<a class="headerlink" href="#updating-tests" title="Permalink to this headline">¶</a></h3>
<p>To update the tests associated with with a manifest from a source
directory:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>manifestparser [options] update manifest from_directory -tag1 -tag2 `key1=value1 `key2=value2 ...
</pre></div>
</div>
</div>
<div class="section" id="usage-example">
<h3>Usage example<a class="headerlink" href="#usage-example" title="Permalink to this headline">¶</a></h3>
<p>Here is an example of how to create manifests for a directory tree and
update the tests listed in the manifests from an external source.</p>
</div>
<div class="section" id="id1">
<h3>Creating Manifests<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Let’s say you want to make a series of manifests for a given directory structure containing <cite>.js</cite> test files:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>testing/mozmill/tests/firefox/
testing/mozmill/tests/firefox/testAwesomeBar/
testing/mozmill/tests/firefox/testPreferences/
testing/mozmill/tests/firefox/testPrivateBrowsing/
testing/mozmill/tests/firefox/testSessionStore/
testing/mozmill/tests/firefox/testTechnicalTools/
testing/mozmill/tests/firefox/testToolbar/
testing/mozmill/tests/firefox/restartTests
</pre></div>
</div>
<p>You can use <cite>manifestparser create</cite> to do this:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>$ manifestparser help create
Usage: manifestparser.py [options] create directory &lt;directory&gt; &lt;...&gt;

     create a manifest from a list of directories

Options:
  -p PATTERN, `pattern=PATTERN
                        glob pattern for files
  -i IGNORE, `ignore=IGNORE
                        directories to ignore
  -w IN_PLACE, --in-place=IN_PLACE
                        Write .ini files in place; filename to write to
</pre></div>
</div>
<p>We only want <cite>.js</cite> files and we want to skip the <cite>restartTests</cite> directory.
We also want to write a manifest per directory, so I use the <cite>–in-place</cite>
option to write the manifests:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>manifestparser create . -i restartTests -p &#39;*.js&#39; -w manifest.ini
</pre></div>
</div>
<p>This creates a manifest.ini per directory that we care about with the JS test files:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>testing/mozmill/tests/firefox/manifest.ini
testing/mozmill/tests/firefox/testAwesomeBar/manifest.ini
testing/mozmill/tests/firefox/testPreferences/manifest.ini
testing/mozmill/tests/firefox/testPrivateBrowsing/manifest.ini
testing/mozmill/tests/firefox/testSessionStore/manifest.ini
testing/mozmill/tests/firefox/testTechnicalTools/manifest.ini
testing/mozmill/tests/firefox/testToolbar/manifest.ini
</pre></div>
</div>
<p>The top-level <cite>manifest.ini</cite> merely has <cite>[include:]</cite> references to the sub manifests:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>[include:testAwesomeBar/manifest.ini]
[include:testPreferences/manifest.ini]
[include:testPrivateBrowsing/manifest.ini]
[include:testSessionStore/manifest.ini]
[include:testTechnicalTools/manifest.ini]
[include:testToolbar/manifest.ini]
</pre></div>
</div>
<p>Each sub-level manifest contains the (<cite>.js</cite>) test files relative to it.</p>
</div>
<div class="section" id="updating-the-tests-from-manifests">
<h3>Updating the tests from manifests<a class="headerlink" href="#updating-the-tests-from-manifests" title="Permalink to this headline">¶</a></h3>
<p>You may need to update tests as given in manifests from a different source directory.
<cite>manifestparser update</cite> was made for just this purpose:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>Usage: manifestparser [options] update manifest directory -tag1 -tag2 `key1=value1 --key2=value2 ...

    update the tests as listed in a manifest from a directory
</pre></div>
</div>
<p>To update from a directory of tests in <cite>~/mozmill/src/mozmill-tests/firefox/</cite> run:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>manifestparser update manifest.ini ~/mozmill/src/mozmill-tests/firefox/
</pre></div>
</div>
</div>
<div class="section" id="tests">
<h3>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h3>
<p>manifestparser includes a suite of tests.</p>
<p><cite>test_manifest.txt</cite> is a doctest that may be helpful in figuring out
how to use the API.  Tests are run via <cite>mach python-test testing/mozbase/manifestparser</cite>.</p>
</div>
<div class="section" id="bugs">
<h3>Bugs<a class="headerlink" href="#bugs" title="Permalink to this headline">¶</a></h3>
<p>Please file any bugs or feature requests at</p>
<p><a class="reference external" href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Testing&amp;component=ManifestParser">https://bugzilla.mozilla.org/enter_bug.cgi?product=Testing&amp;component=ManifestParser</a></p>
<p>Or contact jhammel &#64;mozilla.org or in #ateam on irc.mozilla.org</p>
</div>
<div class="section" id="cli">
<h3>CLI<a class="headerlink" href="#cli" title="Permalink to this headline">¶</a></h3>
<p>Run <cite>manifestparser help</cite> for usage information.</p>
<p>To create a manifest from a set of directories:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>manifestparser [options] create directory &lt;directory&gt; &lt;...&gt; [create-options]
</pre></div>
</div>
<p>To output a manifest of tests:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>manifestparser [options] write manifest &lt;manifest&gt; &lt;...&gt; -tag1 -tag2 --key1=value1 --key2=value2 ...
</pre></div>
</div>
<p>To copy tests and manifests from a source:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>manifestparser [options] copy from_manifest to_manifest -tag1 -tag2 `key1=value1 key2=value2 ...
</pre></div>
</div>
<p>To update the tests associated with with a manifest from a source
directory:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>manifestparser [options] update manifest from_directory -tag1 -tag2 --key1=value1 --key2=value2 ...
</pre></div>
</div>
</div>
<div class="section" id="design-considerations">
<h3>Design Considerations<a class="headerlink" href="#design-considerations" title="Permalink to this headline">¶</a></h3>
<p>Contrary to some opinion, manifestparser.py and the associated .ini
format were not magically plucked from the sky but were descended upon
through several design considerations.</p>
<ul class="simple">
<li>test manifests should be ordered.  While python 2.6 and greater has
a ConfigParser that can use an ordered dictionary, it is a
requirement that we support python 2.4 for the build + testing
environment.  To that end, a <cite>read_ini</cite> function was implemented
in manifestparser.py that should be the equivalent of the .ini
dialect used by ConfigParser.</li>
<li>the manifest format should be easily human readable/writable.  While
there was initially some thought of using JSON, there was pushback
that JSON was not easily editable.  An ideal manifest format would
degenerate to a line-separated list of files.  While .ini format
requires an additional <cite>[]</cite> per line, and while there have been
complaints about this, hopefully this is good enough.</li>
<li>python does not have an in-built YAML parser.  Since it was
undesirable for manifestparser.py to have any dependencies, YAML was
dismissed as a format.</li>
<li>we could have used a proprietary format but decided against it.
Everyone knows .ini and there are good tools to deal with it.
However, since read_ini is the only function that transforms a
manifest to a list of key, value pairs, while the implications for
changing the format impacts downstream code, doing so should be
programmatically simple.</li>
<li>there should be a single file that may easily be
transported. Traditionally, test harnesses have lived in
mozilla-central. This is less true these days and it is increasingly
likely that more tests will not live in mozilla-central going
forward.  So <cite>manifestparser.py</cite> should be highly consumable. To
this end, it is a single file, as appropriate to mozilla-central,
which is also a working python package deployed to PyPI for easy
installation.</li>
</ul>
</div>
<div class="section" id="historical-reference">
<h3>Historical Reference<a class="headerlink" href="#historical-reference" title="Permalink to this headline">¶</a></h3>
<p>Date-ordered list of links about how manifests came to be where they are today:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>* https://wiki.mozilla.org/Auto-tools/Projects/UniversalManifest
* http://alice.nodelman.net/blog/post/2010/05/
* http://alice.nodelman.net/blog/post/universal-manifest-for-unit-tests-a-proposal/
* https://elvis314.wordpress.com/2010/07/05/improving-personal-hygiene-by-adjusting-mochitests/
* https://elvis314.wordpress.com/2010/07/27/types-of-data-we-care-about-in-a-manifest/
* https://bugzilla.mozilla.org/show_bug.cgi?id=585106
* http://elvis314.wordpress.com/2011/05/20/converting-xpcshell-from-listing-directories-to-a-manifest/
* https://bugzilla.mozilla.org/show_bug.cgi?id=616999
* https://developer.mozilla.org/en/Writing_xpcshell-based_unit_tests#Adding_your_tests_to_the_xpcshell_manifest
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="gettinginfo.html" class="btn btn-neutral float-right" title="Getting information on the system under test" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="mozbase" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright .

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'59.0a1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>