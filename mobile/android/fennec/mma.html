

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>MMA Mobile Marketing Automation &mdash; Mozilla Source Tree Docs 59.0a1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Mozilla Source Tree Docs 59.0a1 documentation" href="../../../index.html"/>
        <link rel="up" title="Firefox for Android" href="index.html"/>
        <link rel="next" title="Shipping Default Domains" href="defaultdomains.html"/>
        <link rel="prev" title="Install tracking with the Adjust SDK" href="adjust.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Mozilla Source Tree Docs
          

          
          </a>

          
            
            
              <div class="version">
                59.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../browser/base/sslerrorreport/index.html">SSL Error Reporting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../browser/browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../browser/experiments/experiments/index.html">Telemetry Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gfx/gfx/index.html">Graphics</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Firefox for Android</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="localeswitching.html">Runtime locale switching in Fennec</a></li>
<li class="toctree-l2"><a class="reference internal" href="uitelemetry.html">UI Telemetry</a></li>
<li class="toctree-l2"><a class="reference internal" href="activitystreamtelemetry.html">Activity Stream UI Telemetry</a></li>
<li class="toctree-l2"><a class="reference internal" href="downloadcontenttelemetry.html">Downloadable content (DLC) UI Telemetry</a></li>
<li class="toctree-l2"><a class="reference internal" href="adjust.html">Install tracking with the Adjust SDK</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">MMA Mobile Marketing Automation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-collection">Data collection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#who-will-have-leanplum-enabled">Who will have Leanplum enabled?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#where-does-data-sent-to-the-leanplum-backend-go">Where does data sent to the Leanplum backend go?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#what-data-is-collected-and-sent-to-the-leanplum-backend">What data is collected and sent to the Leanplum backend?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#technical-notes">Technical notes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#build-flags-controlling-the-leanplum-sdk-integration">Build flags controlling the Leanplum SDK integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#technical-notes-on-the-leanplum-sdk-integration">Technical notes on the Leanplum SDK integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#notes-and-links">Notes and links</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="defaultdomains.html">Shipping Default Domains</a></li>
<li class="toctree-l2"><a class="reference internal" href="shutdown.html">Shutting down Firefox for Android</a></li>
<li class="toctree-l2"><a class="reference internal" href="push.html">The architecture of the Fennec Webpush implementation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mozbase/index.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/mach/index.html">mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../taskcluster/taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../testing/geckodriver/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../testing/marionette/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../toolkit/components/crashes/crash-manager/index.html">Crash Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../toolkit/components/extensions/webextensions/index.html">WebExtensions API Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../toolkit/components/payments/docs/index.html">WebPayments UI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../toolkit/components/telemetry/telemetry/index.html">Telemetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../toolkit/components/url-classifier/url-classifier/index.html">URL Classifier</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../toolkit/crashreporter/crashreporter/index.html">Crash Reporter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../toolkit/modules/subprocess/toolkit_modules/subprocess/index.html">Supbrocess Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../toolkit/modules/toolkit_modules/index.html">Toolkit modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../toolkit/mozapps/extensions/addon-manager/index.html">Add-on Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/compare-locales/index.html">Localization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/lint/index.html">Linting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/lint/index.html#indices-and-tables">Indices and tables</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../python/mach.html">mach package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/mozbuild.html">mozbuild package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/mozlint.html">mozlint package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/mozpack.html">mozpack package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/mozversioncontrol.html">mozversioncontrol package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/mozwebidlcodegen.html">mozwebidlcodegen package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python/taskgraph.html">taskgraph package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Mozilla Source Tree Docs</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Firefox for Android</a> &raquo;</li>
        
      <li>MMA Mobile Marketing Automation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/mobile/android/fennec/mma.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mma-mobile-marketing-automation">
<h1>MMA Mobile Marketing Automation<a class="headerlink" href="#mma-mobile-marketing-automation" title="Permalink to this headline">¶</a></h1>
<p>We want to engage with users more. MMA is the project for this purpose. When a user performs a certain
UI action, he/she will see a prompt and have a chance to  interact with it. For example, if a user uses
Firefox 10 times a week, but Firefox is not his default browser, we’ll prompt the user the next time
when he launchers our app, and guide him to set us as default browser.</p>
<p>Mozilla is using a third party framework called “Leanplum” in order to achieve above goal for
Android 56 release. Leanplum is a San Francisco company, founded in 2012. We put their SDK in
our codebase and sync upstream when there’s a major update. Please find it in <code class="docutils literal"><span class="pre">mobile/android/thirdparty/com/leanplum</span></code>.
The SDK is documented at <a class="reference external" href="https://www.leanplum.com/docs/android/">https://www.leanplum.com/docs/android/</a></p>
<p>There are three major component in Leanplum SDK.
1. Events : Triggers when users perform certain actions. An event will normally trigger a prompt message.
2. Deep Links : Actions that users can perform to interact with the prompt message.
3. Messages :  Campaigns that we want to engage with users. Messages is a combination of an Event and a Deep Link.</p>
<div class="section" id="data-collection">
<h2>Data collection<a class="headerlink" href="#data-collection" title="Permalink to this headline">¶</a></h2>
<div class="section" id="who-will-have-leanplum-enabled">
<h3>Who will have Leanplum enabled?<a class="headerlink" href="#who-will-have-leanplum-enabled" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>We use Switchboard <a class="reference external" href="https://wiki.mozilla.org/Firefox/Kinto">https://wiki.mozilla.org/Firefox/Kinto</a> to filter users to have Leanplum enabled. Currently, for users in the USA
and whose locale is set to English, 10% of that users will have Leanplum enabled.</li>
<li>If the user has “Health Report” setting enabled.</li>
<li>If above two are true, when the app starts, and switchboard configure arrived, Fennec will send the
triggers and message interaction history to Leanplum server when available.</li>
</ul>
</div>
<div class="section" id="where-does-data-sent-to-the-leanplum-backend-go">
<h3>Where does data sent to the Leanplum backend go?<a class="headerlink" href="#where-does-data-sent-to-the-leanplum-backend-go" title="Permalink to this headline">¶</a></h3>
<p>The Leanplum SDK is hard-coded to send data to the endpoint <a class="reference external" href="https://www.leanplum.com">https://www.leanplum.com</a>.  The endpoint is
defined by <code class="docutils literal"><span class="pre">com.leanplum.internal.Constants.API_HOST_NAME</span></code> at
<a class="reference external" href="https://searchfox.org/mozilla-central/rev/c49a70b53f67dd5550eec8a08793805f2aca8d42/mobile/android/thirdparty/com/leanplum/internal/Constants.java#32">https://searchfox.org/mozilla-central/rev/c49a70b53f67dd5550eec8a08793805f2aca8d42/mobile/android/thirdparty/com/leanplum/internal/Constants.java#32</a>.</p>
<p>The user is identified by Leanplum using a random UUID generated by Fennec when Leanplum is initialized for the first time.
This unique identifier is only used by Leanplum and can’t be tracked back to any Firefox users.</p>
</div>
<div class="section" id="what-data-is-collected-and-sent-to-the-leanplum-backend">
<h3>What data is collected and sent to the Leanplum backend?<a class="headerlink" href="#what-data-is-collected-and-sent-to-the-leanplum-backend" title="Permalink to this headline">¶</a></h3>
<p>The Leanplum SDK collects and sends two messages to the Leanplum backend.  The messages have the
following parameters:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Sent</span> <span class="n">every</span> <span class="n">time</span> <span class="n">when</span> <span class="n">an</span> <span class="n">event</span> <span class="ow">is</span> <span class="n">triggered</span>
<span class="s2">&quot;action&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;track&quot;</span>                   <span class="o">//</span> <span class="n">track</span><span class="p">:</span> <span class="n">an</span> <span class="n">event</span> <span class="ow">is</span> <span class="n">tracked</span><span class="o">.</span>
<span class="s2">&quot;event&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;Launch&quot;</span>                   <span class="o">//</span> <span class="n">Used</span> <span class="n">when</span> <span class="n">an</span> <span class="n">event</span> <span class="ow">is</span> <span class="n">triggered</span><span class="o">.</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">E_Saved_Bookmark</span><span class="o">.</span>
<span class="s2">&quot;info&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;&quot;</span>                          <span class="o">//</span> <span class="n">Used</span> <span class="n">when</span> <span class="n">an</span> <span class="n">event</span> <span class="ow">is</span> <span class="n">triggered</span><span class="o">.</span> <span class="n">Basic</span> <span class="n">context</span> <span class="n">associated</span> <span class="k">with</span> <span class="n">the</span> <span class="n">event</span><span class="o">.</span>
<span class="s2">&quot;value&quot;</span> <span class="o">-&gt;</span> <span class="mf">0.0</span>                        <span class="o">//</span> <span class="n">Used</span> <span class="n">when</span> <span class="n">an</span> <span class="n">event</span> <span class="ow">is</span> <span class="n">triggered</span><span class="o">.</span> <span class="n">Value</span> <span class="n">of</span> <span class="n">that</span> <span class="n">event</span><span class="o">.</span>
<span class="s2">&quot;messageId&quot;</span> <span class="o">-&gt;</span> <span class="mi">5111602214338560</span>       <span class="o">//</span> <span class="n">Used</span> <span class="n">when</span> <span class="n">an</span> <span class="n">event</span> <span class="ow">is</span> <span class="n">triggered</span><span class="o">.</span> <span class="n">The</span> <span class="n">ID</span> <span class="n">of</span> <span class="n">the</span> <span class="n">message</span><span class="o">.</span>

<span class="o">//</span> <span class="n">Sent</span> <span class="n">when</span> <span class="n">the</span> <span class="n">app</span> <span class="n">starts</span>
<span class="s2">&quot;action&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;start&quot;</span>                   <span class="o">//</span> <span class="n">start</span><span class="p">:</span> <span class="n">Leanplum</span> <span class="n">SDK</span> <span class="n">starts</span><span class="o">.</span> <span class="n">heartbeat</span>
<span class="s2">&quot;userAttributes&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;{                // A set of key-value pairs used to describe the user.</span>
  <span class="s2">&quot;Focus Installed&quot;</span> <span class="o">-&gt;</span> <span class="n">true</span>           <span class="o">//</span> <span class="n">If</span> <span class="n">Focus</span> <span class="k">for</span> <span class="n">Android</span> <span class="ow">is</span> <span class="n">installed</span><span class="o">.</span>
  <span class="s2">&quot;Klar Installed&quot;</span> <span class="o">-&gt;</span> <span class="n">true</span>            <span class="o">//</span> <span class="n">If</span> <span class="n">Klar</span> <span class="k">for</span> <span class="n">Android</span> <span class="ow">is</span> <span class="n">installed</span><span class="o">.</span>
  <span class="s2">&quot;Pocket Installed&quot;</span> <span class="o">-&gt;</span> <span class="n">true</span>          <span class="o">//</span> <span class="n">If</span> <span class="n">Pocket</span> <span class="k">for</span> <span class="n">Android</span> <span class="ow">is</span> <span class="n">installed</span><span class="o">.</span>
  <span class="s2">&quot;Signed In Sync&quot;</span> <span class="o">-&gt;</span> <span class="n">true</span>            <span class="o">//</span> <span class="n">If</span> <span class="n">the</span> <span class="n">user</span> <span class="n">has</span> <span class="n">signed</span> <span class="ow">in</span> <span class="n">to</span> <span class="n">Mozilla</span> <span class="n">account</span><span class="o">.</span>
  <span class="s2">&quot;Default Browser&quot;</span> <span class="o">-&gt;</span> <span class="n">true</span>           <span class="o">//</span> <span class="n">If</span> <span class="n">the</span> <span class="n">user</span> <span class="n">has</span> <span class="nb">set</span> <span class="n">Fennec</span> <span class="k">as</span> <span class="n">default</span> <span class="n">browser</span><span class="o">.</span>
<span class="p">}</span>
<span class="s2">&quot;appId&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;app_6Ao....&quot;</span>              <span class="o">//</span> <span class="n">Leanplum</span> <span class="n">App</span> <span class="n">ID</span><span class="o">.</span>
<span class="s2">&quot;clientKey&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;dev_srwDUNZR....&quot;</span>     <span class="o">//</span> <span class="n">Leanplum</span> <span class="n">client</span> <span class="n">access</span> <span class="n">key</span><span class="o">.</span>
<span class="s2">&quot;systemName&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;Android OS&quot;</span>          <span class="o">//</span> <span class="n">Fixed</span> <span class="n">String</span> <span class="ow">in</span> <span class="n">SDK</span><span class="o">.</span>
<span class="s2">&quot;locale&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;zh_TW&quot;</span>                   <span class="o">//</span> <span class="n">System</span> <span class="n">Locale</span><span class="o">.</span>
<span class="s2">&quot;timezone&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;Asia/Taipei&quot;</span>           <span class="o">//</span> <span class="n">System</span> <span class="n">Timezone</span><span class="o">.</span>
<span class="s2">&quot;versionName&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;55.0a1&quot;</span>             <span class="o">//</span> <span class="n">Fennec</span> <span class="n">version</span><span class="o">.</span>
<span class="s2">&quot;systemVersion&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;7.1.2&quot;</span>            <span class="o">//</span> <span class="n">System</span> <span class="n">version</span><span class="o">.</span>
<span class="s2">&quot;deviceModel&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;Google Pixel&quot;</span>       <span class="o">//</span> <span class="n">System</span> <span class="n">device</span> <span class="n">model</span><span class="o">.</span>
<span class="s2">&quot;timezoneOffsetSeconds&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;28800&quot;</span>    <span class="o">//</span> <span class="n">User</span> <span class="n">timezone</span> <span class="n">offset</span> <span class="k">with</span> <span class="n">PST</span><span class="o">.</span>
<span class="s2">&quot;deviceName&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;Google Pixel&quot;</span>        <span class="o">//</span> <span class="n">System</span> <span class="n">device</span> <span class="n">name</span><span class="o">.</span>
<span class="s2">&quot;region&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;(detect)&quot;</span>                <span class="o">//</span> <span class="n">Not</span> <span class="n">used</span><span class="o">.</span> <span class="n">We</span> <span class="n">strip</span> <span class="n">play</span><span class="o">-</span><span class="n">SERVICES</span><span class="o">-</span><span class="n">location</span> <span class="n">so</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">will</span> <span class="n">be</span> <span class="n">the</span> <span class="n">default</span> <span class="n">stub</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">Leanplum</span> <span class="n">SDK</span><span class="o">.</span>
<span class="s2">&quot;city&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;(detect)&quot;</span>                  <span class="o">//</span> <span class="n">Same</span> <span class="k">as</span> <span class="n">above</span><span class="o">.</span>
<span class="s2">&quot;country&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;(detect)&quot;</span>               <span class="o">//</span> <span class="n">Same</span> <span class="k">as</span> <span class="n">above</span><span class="o">.</span>
<span class="s2">&quot;location&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;(detect)&quot;</span>              <span class="o">//</span> <span class="n">Same</span> <span class="k">as</span> <span class="n">above</span><span class="o">.</span>
<span class="s2">&quot;newsfeedMessages&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot; size = 0&quot;</span>     <span class="o">//</span> <span class="n">Not</span> <span class="n">used</span><span class="o">.</span> <span class="n">New</span> <span class="n">Leanplum</span> <span class="n">Inbox</span> <span class="n">message</span><span class="p">(</span><span class="n">Leanplum</span> <span class="n">feature</span><span class="p">)</span> <span class="n">count</span><span class="o">.</span>
<span class="s2">&quot;includeDefaults&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;false&quot;</span>          <span class="o">//</span> <span class="n">Not</span> <span class="n">used</span><span class="o">.</span> <span class="n">Always</span> <span class="n">false</span><span class="o">.</span>

<span class="o">//</span> <span class="n">Other</span> <span class="n">life</span> <span class="n">cycle</span> <span class="n">actions</span>
<span class="s2">&quot;action&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;heartbeat&quot;</span>               <span class="o">//</span> <span class="n">heartbeat</span><span class="p">:</span> <span class="n">every</span> <span class="mi">15</span> <span class="n">minutes</span> <span class="n">when</span> <span class="n">app</span> <span class="ow">is</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">foreground</span>
                                      <span class="o">//</span> <span class="n">pauseSession</span><span class="p">:</span> <span class="n">when</span> <span class="n">app</span> <span class="n">goes</span> <span class="n">to</span> <span class="n">background</span>
                                      <span class="o">//</span> <span class="n">resumeSession</span><span class="p">:</span> <span class="n">when</span> <span class="n">app</span> <span class="n">goes</span> <span class="n">to</span> <span class="n">foreground</span>

<span class="o">//</span> <span class="n">Sent</span> <span class="k">for</span> <span class="n">every</span> <span class="n">action</span>
<span class="s2">&quot;userId&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;b13b3c239d01aa7c&quot;</span>        <span class="o">//</span> <span class="n">Set</span> <span class="n">by</span> <span class="n">Fennec</span><span class="p">,</span> <span class="n">we</span> <span class="n">use</span> <span class="n">random</span> <span class="n">uuid</span> <span class="n">so</span> <span class="n">users</span> <span class="n">are</span> <span class="n">anonymous</span> <span class="n">to</span> <span class="n">Leanplum</span><span class="o">.</span>
<span class="s2">&quot;deviceId&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;b13b3c239d01aa7c&quot;</span>      <span class="o">//</span> <span class="n">Same</span> <span class="k">as</span> <span class="n">above</span><span class="o">.</span>
<span class="s2">&quot;sdkVersion&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;2.2.2-SNAPSHOT&quot;</span>      <span class="o">//</span> <span class="n">Leanplum</span> <span class="n">SDK</span> <span class="n">version</span><span class="o">.</span>
<span class="s2">&quot;devMode&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;true&quot;</span>                   <span class="o">//</span> <span class="n">If</span> <span class="n">the</span> <span class="n">SDK</span> <span class="ow">is</span> <span class="ow">in</span> <span class="n">developer</span> <span class="n">mode</span><span class="o">.</span> <span class="n">For</span> <span class="n">official</span> <span class="n">builds</span><span class="p">,</span> <span class="n">it</span><span class="s1">&#39;s false.</span>
<span class="s2">&quot;time&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;1.497595093902E9&quot;</span>          <span class="o">//</span> <span class="n">System</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">second</span><span class="o">.</span>
<span class="s2">&quot;token&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;nksZ5pa0R5iegC7wj....&quot;</span>    <span class="o">//</span> <span class="n">Token</span> <span class="n">come</span> <span class="kn">from</span> <span class="nn">Leanplum</span> <span class="n">backend</span><span class="o">.</span>


<span class="s2">&quot;gcmRegistrationId&quot;</span> <span class="o">-&gt;</span> <span class="s2">&quot;APA91....&quot;</span>    <span class="o">//</span> <span class="n">Send</span> <span class="n">GCM</span> <span class="n">token</span> <span class="n">to</span> <span class="n">Leanplum</span> <span class="n">backend</span><span class="o">.</span> <span class="n">This</span> <span class="n">happens</span> <span class="n">separately</span> <span class="n">when</span> <span class="n">Leanplum</span> <span class="n">SDK</span> <span class="n">gets</span> <span class="n">initialized</span><span class="o">.</span>
</pre></div>
</div>
<div class="section" id="notes-on-what-data-is-collected">
<h4>Notes on what data is collected<a class="headerlink" href="#notes-on-what-data-is-collected" title="Permalink to this headline">¶</a></h4>
<p>User Identifier:
Since Device ID is a random UUID, Leanplum can’t map the device to any know Client ID in Fennec nor Advertising ID.</p>
<p>Events:
Most of the Leanplum events can be mapped to a single combination of Telemetry event (Event+Method+Extra).
Some events are not collected in Mozilla Telemetry. This will be addressed separately in each campaign review.
There are three elements that are used for each event. They are: event name, value(default: 0.0), and info(default: “”).
Default value for event value is 0.0. Default value for event info is empty string.</p>
<p>List of current Events related data that is sent:
* When a page could be reader mode and is visible to the user
{</p>
<blockquote>
<div>“event” : “E_Reader_Available”</div></blockquote>
<p>}
* Download videos or any other media
{</p>
<blockquote>
<div>“event” : “E_Download_Media_Saved_Image”</div></blockquote>
<p>}
* Save password and login from door hanger
{</p>
<blockquote>
<div>“event” : “E_Saved_Login_And_Password”</div></blockquote>
<p>}
* Save a bookmark from Fennec menu
{</p>
<blockquote>
<div>“event” : “E_Saved_Bookmark”</div></blockquote>
<p>}
* Load the bookmark from home panel
{</p>
<blockquote>
<div>“event” : “E_Opened_Bookmark”</div></blockquote>
<p>}
* Interact with search url area
{</p>
<blockquote>
<div>“event” : “E_Interact_With_Search_URL_Area”</div></blockquote>
<p>}
* When a screenshot is taken
{</p>
<blockquote>
<div>“event” : “E_Screenshot”</div></blockquote>
<p>}
* Open a new tab
{</p>
<blockquote>
<div>“event” : “E_Opened_New_Tab”</div></blockquote>
<p>}
* App start but Fennec is not set as default browser
{</p>
<blockquote>
<div>“event” : “E_Launch_But_Not_Default_Browser”</div></blockquote>
<p>}
* General app start event
{</p>
<blockquote>
<div>“event” : “E_Launch_Browser”</div></blockquote>
<p>}
Deep Links:
Deep links are actions that can point Fennec to open certain pages or load features such as <cite>show bookmark list</cite> or
<cite>open a SUMO page</cite>. When users see a prompt Leanplum message, they can click the button(s) on it. These buttons can
trigger the following deep links
* Link to Set Default Browser settings (firefox://default_browser)
* Link to specific Add-on page (http://link_to_the_add_on_page)
* Link to sync signup/sign in (firefox://sign_up)
* Link to default search engine settings (firefox://preferences_search)
* Link to “Save as PDF” feature (firefox://save_as_pdf)
* Take user directly to a Sign up for a newsletter (http://link_to_newsletter_page)
* Link to bookmark list (firefox://bookmark_list)
* Link to history list (firefox://history_list)
* Link to main preferences (firefox://preferences)
* Link to privacy preferences (firefox://preferences_privacy)
* Link to notifications preferences (firefox://preferences_notifications)
* Link to accessibility preferences (firefox://preferences_accessibility)
* Link to general setting (firefox://preferences_general)
* Link to home page setting (firefox://preferences_home)</p>
<p>Messages :
Messages are prompts to the user from Leanplum. Messages can be in-app prompts or push notifications. The interaction of that prompt will be kept and sent to Leanplum backend (such
as “Accept” and “Show”). A messages is a combination of an Event and a Deep Link. The combinations are downloaded from Leanplum
when Leanplum SDK is initialized. When the criteria is met (set in Leanplum backend, could be when an event happens a certain number of times,
and/or targeting certain user attribute ), a prompt message will show up. And there may be buttons for users to click. Those clicks
may trigger deep links.</p>
<p>We use another Mozilla’s Google Cloud Messaging(GCM) sender ID to send push notifications.
These push notifications will look like the notifications that Sync sends out.
Sender ID let GCM knows Mozilla is sending push notifications via Leanplum.
GCM will generate a token at client side. We’ll send this GCM token to Leanplum so Leanplum knows whom to send push notifications.
This token is only useful to Mozilla’s sender ID so it’s anonymized to other parties.
Push Notifications can be triggered by Events, or be sent by Mozilla marketing team manually.</p>
<p>The list of current messages for Android can be found here: <a class="reference external" href="https://wiki.mozilla.org/Leanplum_Contextual_Hints#Android">https://wiki.mozilla.org/Leanplum_Contextual_Hints#Android</a></p>
</div>
</div>
</div>
<div class="section" id="technical-notes">
<h2>Technical notes<a class="headerlink" href="#technical-notes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="build-flags-controlling-the-leanplum-sdk-integration">
<h3>Build flags controlling the Leanplum SDK integration<a class="headerlink" href="#build-flags-controlling-the-leanplum-sdk-integration" title="Permalink to this headline">¶</a></h3>
<p>To test this locally, add lines like:</p>
<p>export MOZ_ANDROID_MMA=1
ac_add_options –with-leanplum-sdk-keyfile=/path/to/leanplum-sdk-developer.token</p>
<p>MOZ_ANDROID_MMA depends on MOZ_NATIVE_DEVICES and MOZ_ANDROID_GCM.
Since Leanplum requires Google Play Services library, those flags are a proxy for it, and enable respectively.</p>
<p>We want to enable MOZ_ANDROID_MMA in Nightly, but only for
MOZILLA_OFFICIAL builds.  Since MOZILLA_OFFICIAL is still defined in
old-configure.in, we can’t integrate it in
mobile/android/moz.configure, and therefore we enable using the
automation mozconfigs.</p>
</div>
<div class="section" id="technical-notes-on-the-leanplum-sdk-integration">
<h3>Technical notes on the Leanplum SDK integration<a class="headerlink" href="#technical-notes-on-the-leanplum-sdk-integration" title="Permalink to this headline">¶</a></h3>
<p>Just like Adjust, MmaDelegate uses mmaInterface to inject the MmaLeanplumImp and MmaStubImp.
Constants used by Leanplum is in MmaConstants. Services in AndroidManifest are in
<code class="docutils literal"><span class="pre">mobile/android/base/MmaAndroidManifest_services.xml.in</span></code> which is also injected by build flag
MOZ_ANDROID_MMA.</p>
</div>
<div class="section" id="notes-and-links">
<h3>Notes and links<a class="headerlink" href="#notes-and-links" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Leanplum web page: <a class="reference external" href="http://leanplum.com/">http://leanplum.com/</a></li>
<li>Leanplum SDK github repo: <a class="reference external" href="https://github.com/Leanplum/Leanplum-Android-SDK">https://github.com/Leanplum/Leanplum-Android-SDK</a></li>
</ul>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="defaultdomains.html" class="btn btn-neutral float-right" title="Shipping Default Domains" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="adjust.html" class="btn btn-neutral" title="Install tracking with the Adjust SDK" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright .

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'59.0a1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>