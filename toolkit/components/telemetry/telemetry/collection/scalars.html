

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Scalars &mdash; Mozilla Source Tree Docs 59.0a1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../../search.html"/>
    <link rel="top" title="Mozilla Source Tree Docs 59.0a1 documentation" href="../../../../../index.html"/>
        <link rel="up" title="Data collection" href="index.html"/>
        <link rel="next" title="Histograms" href="histograms.html"/>
        <link rel="prev" title="Data collection" href="index.html"/> 

  
  <script src="../../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../../index.html" class="icon icon-home"> Mozilla Source Tree Docs
          

          
          </a>

          
            
            
              <div class="version">
                59.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../browser/base/sslerrorreport/index.html">SSL Error Reporting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../browser/browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../browser/experiments/experiments/index.html">Telemetry Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../gfx/gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../mobile/android/fennec/index.html">Firefox for Android</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../mobile/android/fennec/index.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../mozbase/index.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../python/mach/index.html">mach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../taskcluster/taskcluster/index.html">TaskCluster Task-Graph Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../testing/geckodriver/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../testing/marionette/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../crashes/crash-manager/index.html">Crash Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../extensions/webextensions/index.html">WebExtensions API Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../payments/docs/index.html">WebPayments UI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Telemetry</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../concepts/index.html">Concepts</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Data collection</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Scalars</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-api">The API</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-yaml-definition-file">The YAML definition file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-processor-scripts">The processor scripts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-a-new-probe">Adding a new probe</a></li>
<li class="toctree-l4"><a class="reference internal" href="#version-history">Version History</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="histograms.html">Histograms</a></li>
<li class="toctree-l3"><a class="reference internal" href="events.html">Events</a></li>
<li class="toctree-l3"><a class="reference internal" href="measuring-time.html">Measuring elapsed time</a></li>
<li class="toctree-l3"><a class="reference internal" href="custom-pings.html">Submitting custom pings</a></li>
<li class="toctree-l3"><a class="reference internal" href="stack-capture.html">Stack capture</a></li>
<li class="toctree-l3"><a class="reference internal" href="experiments.html">Experiment Annotation</a></li>
<li class="toctree-l3"><a class="reference internal" href="uptake.html">Uptake Telemetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="use-counters.html">Use Counters</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#browser-usage-telemetry">Browser Usage Telemetry</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../data/index.html">Data documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internals/index.html">Internals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fhr/index.html">Firefox Health Report (Obsolete)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../url-classifier/url-classifier/index.html">URL Classifier</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../crashreporter/crashreporter/index.html">Crash Reporter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules/subprocess/toolkit_modules/subprocess/index.html">Supbrocess Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules/toolkit_modules/index.html">Toolkit modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mozapps/extensions/addon-manager/index.html">Add-on Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tools/compare-locales/index.html">Localization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tools/lint/index.html">Linting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tools/lint/index.html#indices-and-tables">Indices and tables</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../python/mach.html">mach package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../python/mozbuild.html">mozbuild package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../python/mozlint.html">mozlint package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../python/mozpack.html">mozpack package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../python/mozversioncontrol.html">mozversioncontrol package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../python/mozwebidlcodegen.html">mozwebidlcodegen package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../python/taskgraph.html">taskgraph package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Mozilla Source Tree Docs</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Telemetry</a> &raquo;</li>
        
          <li><a href="index.html">Data collection</a> &raquo;</li>
        
      <li>Scalars</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../../_sources/toolkit/components/telemetry/telemetry/collection/scalars.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="scalars">
<h1>Scalars<a class="headerlink" href="#scalars" title="Permalink to this headline">¶</a></h1>
<p>Historically we started to overload our histogram mechanism to also collect scalar data,
such as flag values, counts, labels and others.
The scalar measurement types are the suggested way to collect that kind of scalar data.
The serialized scalar data is submitted with the <a class="reference internal" href="../data/main-ping.html"><span class="doc">main pings</span></a>.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Every new data collection in Firefox needs a <a class="reference external" href="https://wiki.mozilla.org/Firefox/Data_Collection#Requesting_Approval">data collection review</a> from a data collection peer. Just set the feedback? flag for one of the data peers. We try to reply within a business day.</p>
</div>
<div class="section" id="the-api">
<h2>The API<a class="headerlink" href="#the-api" title="Permalink to this headline">¶</a></h2>
<p>Scalar probes can be managed either through the <a class="reference external" href="https://dxr.mozilla.org/mozilla-central/source/toolkit/components/telemetry/nsITelemetry.idl">nsITelemetry interface</a>
or the <a class="reference external" href="https://dxr.mozilla.org/mozilla-central/source/toolkit/components/telemetry/Telemetry.h">C++ API</a>.</p>
<div class="section" id="js-api">
<h3>JS API<a class="headerlink" href="#js-api" title="Permalink to this headline">¶</a></h3>
<p>Probes in privileged JavaScript code can use the following functions to manipulate scalars:</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">Services</span><span class="p">.</span><span class="nx">telemetry</span><span class="p">.</span><span class="nx">scalarAdd</span><span class="p">(</span><span class="nx">aName</span><span class="p">,</span> <span class="nx">aValue</span><span class="p">);</span>
<span class="nx">Services</span><span class="p">.</span><span class="nx">telemetry</span><span class="p">.</span><span class="nx">scalarSet</span><span class="p">(</span><span class="nx">aName</span><span class="p">,</span> <span class="nx">aValue</span><span class="p">);</span>
<span class="nx">Services</span><span class="p">.</span><span class="nx">telemetry</span><span class="p">.</span><span class="nx">scalarSetMaximum</span><span class="p">(</span><span class="nx">aName</span><span class="p">,</span> <span class="nx">aValue</span><span class="p">);</span>

<span class="nx">Services</span><span class="p">.</span><span class="nx">telemetry</span><span class="p">.</span><span class="nx">keyedScalarAdd</span><span class="p">(</span><span class="nx">aName</span><span class="p">,</span> <span class="nx">aKey</span><span class="p">,</span> <span class="nx">aValue</span><span class="p">);</span>
<span class="nx">Services</span><span class="p">.</span><span class="nx">telemetry</span><span class="p">.</span><span class="nx">keyedScalarSet</span><span class="p">(</span><span class="nx">aName</span><span class="p">,</span> <span class="nx">aKey</span><span class="p">,</span> <span class="nx">aValue</span><span class="p">);</span>
<span class="nx">Services</span><span class="p">.</span><span class="nx">telemetry</span><span class="p">.</span><span class="nx">keyedScalarSetMaximum</span><span class="p">(</span><span class="nx">aName</span><span class="p">,</span> <span class="nx">aKey</span><span class="p">,</span> <span class="nx">aValue</span><span class="p">);</span>
</pre></div>
</div>
<p>These functions can throw if, for example, an operation is performed on a scalar type that doesn’t support it
(e.g. calling scalarSetMaximum on a scalar of the string kind). Please look at the <a class="reference external" href="https://dxr.mozilla.org/mozilla-central/search?q=regexp%3ATelemetryScalar%3A%3A(Set%7CAdd)+file%3ATelemetryScalar.cpp&amp;redirect=false">code documentation</a> for
additional information.</p>
<div class="section" id="registerscalars">
<h4><code class="docutils literal"><span class="pre">registerScalars()</span></code><a class="headerlink" href="#registerscalars" title="Permalink to this headline">¶</a></h4>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">Services</span><span class="p">.</span><span class="nx">telemetry</span><span class="p">.</span><span class="nx">registerScalars</span><span class="p">(</span><span class="nx">category</span><span class="p">,</span> <span class="nx">scalarData</span><span class="p">);</span>
</pre></div>
</div>
<p>Register new scalars from add-ons.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">category</span></code> - <em>(required, string)</em> The unique category the scalars are registered in (see <a class="reference internal" href="#scalar-limitations"><span class="std std-ref">limitations</span></a>).</li>
<li><code class="docutils literal"><span class="pre">scalarData</span></code> - <em>(required, object)</em> An object of the form <code class="docutils literal"><span class="pre">{scalarName1:</span> <span class="pre">scalar1Data,</span> <span class="pre">...}</span></code> that contains registration data for multiple scalars; <code class="docutils literal"><span class="pre">scalarName1</span></code> is subject to <a class="reference internal" href="#scalar-limitations"><span class="std std-ref">limitations</span></a>; each scalar is an object with the following properties:<ul>
<li><code class="docutils literal"><span class="pre">kind</span></code> - <em>(required, uint)</em>  One of the scalar types (nsITelemetry::SCALAR_TYPE_*).</li>
<li><code class="docutils literal"><span class="pre">keyed</span></code> - <em>(optional, bool)</em> Whether this is a keyed scalar or not. Defaults to false.</li>
<li><code class="docutils literal"><span class="pre">record_on_release</span></code> - <em>(optional, bool)</em> Whether to record this data on release. Defaults to false.</li>
<li><code class="docutils literal"><span class="pre">expired</span></code> - <em>(optional, bool)</em> Whether this scalar entry is expired. This allows recording it without error, but it will be discarded. Defaults to false.</li>
</ul>
</li>
</ul>
<p>For scalars recorded from add-ons, registration happens at runtime. Any new scalar must first be registered through this function before they can be recorded.</p>
<p>After registration, the scalars can be recorded through the usual scalar JS API. If the accumulation happens in a content process right after the registration and the definition still has to reach this process, it will be discarded: one way to work around the problem is to send an IPC message to the content process and start accumulating data once this message has been received. The accumulated data will be submitted in the main pings payload under <code class="docutils literal"><span class="pre">processes.dynamic.scalars</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Accumulating in dynamic scalars only works in content child processes and in the parent process. All the accumulations (parent and content chldren) are aggregated together .</p>
</div>
<p>New scalars registered here are subject to the same <a class="reference internal" href="#scalar-limitations"><span class="std std-ref">limitations</span></a> as the ones registered through <code class="docutils literal"><span class="pre">Scalars.yaml</span></code>, e.g. the length of the category name or the allowed characters.</p>
<p>When add-ons are updated, they may re-register all of their scalars. In that case, any changes to scalars that are already registered are ignored. The only exception is expiry; a scalar that is re-registered with <code class="docutils literal"><span class="pre">expired:</span> <span class="pre">true</span></code> will not be recorded anymore.</p>
<p>Example:</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="nx">Services</span><span class="p">.</span><span class="nx">telemetry</span><span class="p">.</span><span class="nx">registerScalars</span><span class="p">(</span><span class="s2">&quot;myAddon.category&quot;</span><span class="p">,</span> <span class="p">{</span>
  <span class="s2">&quot;counter_scalar&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">kind</span><span class="o">:</span> <span class="nx">Ci</span><span class="p">.</span><span class="nx">nsITelemetry</span><span class="p">.</span><span class="nx">SCALAR_TYPE_COUNT</span><span class="p">,</span>
    <span class="nx">keyed</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">record_on_release</span><span class="o">:</span> <span class="kc">false</span>
  <span class="p">},</span>
<span class="p">});</span>
<span class="c1">// Now scalars can be recorded.</span>
<span class="nx">Services</span><span class="p">.</span><span class="nx">telemetry</span><span class="p">.</span><span class="nx">scalarSet</span><span class="p">(</span><span class="s2">&quot;myAddon.category.counter_scalar&quot;</span><span class="p">,</span> <span class="mi">37</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h3>C++ API<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Probes in native code can use the more convenient helper functions declared in <a class="reference external" href="https://dxr.mozilla.org/mozilla-central/source/toolkit/components/telemetry/Telemetry.h">Telemetry.h</a>:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">ScalarAdd</span><span class="p">(</span><span class="n">mozilla</span><span class="o">::</span><span class="n">Telemetry</span><span class="o">::</span><span class="n">ScalarID</span> <span class="n">aId</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">aValue</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">ScalarSet</span><span class="p">(</span><span class="n">mozilla</span><span class="o">::</span><span class="n">Telemetry</span><span class="o">::</span><span class="n">ScalarID</span> <span class="n">aId</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">aValue</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">ScalarSet</span><span class="p">(</span><span class="n">mozilla</span><span class="o">::</span><span class="n">Telemetry</span><span class="o">::</span><span class="n">ScalarID</span> <span class="n">aId</span><span class="p">,</span> <span class="k">const</span> <span class="n">nsAString</span><span class="o">&amp;</span> <span class="n">aValue</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">ScalarSet</span><span class="p">(</span><span class="n">mozilla</span><span class="o">::</span><span class="n">Telemetry</span><span class="o">::</span><span class="n">ScalarID</span> <span class="n">aId</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">aValue</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">ScalarSetMaximum</span><span class="p">(</span><span class="n">mozilla</span><span class="o">::</span><span class="n">Telemetry</span><span class="o">::</span><span class="n">ScalarID</span> <span class="n">aId</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">aValue</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">ScalarAdd</span><span class="p">(</span><span class="n">mozilla</span><span class="o">::</span><span class="n">Telemetry</span><span class="o">::</span><span class="n">ScalarID</span> <span class="n">aId</span><span class="p">,</span> <span class="k">const</span> <span class="n">nsAString</span><span class="o">&amp;</span> <span class="n">aKey</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">aValue</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">ScalarSet</span><span class="p">(</span><span class="n">mozilla</span><span class="o">::</span><span class="n">Telemetry</span><span class="o">::</span><span class="n">ScalarID</span> <span class="n">aId</span><span class="p">,</span> <span class="k">const</span> <span class="n">nsAString</span><span class="o">&amp;</span> <span class="n">aKey</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">aValue</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">ScalarSet</span><span class="p">(</span><span class="n">mozilla</span><span class="o">::</span><span class="n">Telemetry</span><span class="o">::</span><span class="n">ScalarID</span> <span class="n">aId</span><span class="p">,</span> <span class="k">const</span> <span class="n">nsAString</span><span class="o">&amp;</span> <span class="n">aKey</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">aValue</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">ScalarSetMaximum</span><span class="p">(</span><span class="n">mozilla</span><span class="o">::</span><span class="n">Telemetry</span><span class="o">::</span><span class="n">ScalarID</span> <span class="n">aId</span><span class="p">,</span> <span class="k">const</span> <span class="n">nsAString</span><span class="o">&amp;</span> <span class="n">aKey</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">aValue</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Scalar operations are designed to be cheap, not free. If you wish to manipulate Scalars in a performance-sensitive piece of code, store the operations locally and change the Scalar only after the performance-sensitive piece (“hot path”) has completed.</p>
</div>
</div>
</div>
<div class="section" id="the-yaml-definition-file">
<h2>The YAML definition file<a class="headerlink" href="#the-yaml-definition-file" title="Permalink to this headline">¶</a></h2>
<p>Scalar probes are required to be registered, both for validation and transparency reasons,
in the <a class="reference external" href="https://dxr.mozilla.org/mozilla-central/source/toolkit/components/telemetry/Scalars.yaml">Scalars.yaml</a>
definition file.</p>
<p>The probes in the definition file are represented in a fixed-depth, two-level structure:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="c1"># The following is a category.</span>
<span class="l l-Scalar l-Scalar-Plain">a.category.hierarchy</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">a_probe_name</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">uint</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">another_probe</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="l l-Scalar l-Scalar-Plain">category2</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">probe</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">int</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p id="scalar-limitations">Category and probe names need to follow a few rules:</p>
<ul class="simple">
<li>they cannot exceed 40 characters each;</li>
<li>category names must be alpha-numeric + <code class="docutils literal"><span class="pre">.</span></code>, with no leading/trailing digit or <code class="docutils literal"><span class="pre">.</span></code>;</li>
<li>probe names must be alpha-numeric + <code class="docutils literal"><span class="pre">_</span></code>, with no leading/trailing digit or <code class="docutils literal"><span class="pre">_</span></code>.</li>
</ul>
<p>A probe can be defined as follows:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">a.category.hierarchy</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">a_scalar</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">bug_numbers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1276190</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">A nice one-line description.</span>
    <span class="l l-Scalar l-Scalar-Plain">expires</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">never</span>
    <span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">uint</span>
    <span class="l l-Scalar l-Scalar-Plain">notification_emails</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">telemetry-client-dev@mozilla.com</span>
</pre></div>
</div>
<div class="section" id="required-fields">
<h3>Required Fields<a class="headerlink" href="#required-fields" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">bug_numbers</span></code>: A list of unsigned integers representing the number of the bugs the probe was introduced in.</li>
<li><code class="docutils literal"><span class="pre">description</span></code>: A single or multi-line string describing what data the probe collects and when it gets collected.</li>
<li><code class="docutils literal"><span class="pre">expires</span></code>: The version number in which the scalar expires, e.g. “30”; a version number of type “N” and “N.0” is automatically converted to “N.0a1” in order to expire the scalar also in the development channels. A telemetry probe acting on an expired scalar will print a warning into the browser console. For scalars that never expire the value <code class="docutils literal"><span class="pre">never</span></code> can be used.</li>
<li><code class="docutils literal"><span class="pre">kind</span></code>: A string representing the scalar type. Allowed values are <code class="docutils literal"><span class="pre">uint</span></code>, <code class="docutils literal"><span class="pre">string</span></code> and <code class="docutils literal"><span class="pre">boolean</span></code>.</li>
<li><code class="docutils literal"><span class="pre">notification_emails</span></code>: A list of email addresses to notify with alerts of expiring probes. More importantly, these are used by the data steward to verify that the probe is still useful.</li>
<li><code class="docutils literal"><span class="pre">record_in_processes</span></code>: A list of processes the scalar is allowed to record in. Currently supported values are:<ul>
<li><code class="docutils literal"><span class="pre">main</span></code>;</li>
<li><code class="docutils literal"><span class="pre">content</span></code>;</li>
<li><code class="docutils literal"><span class="pre">gpu</span></code>;</li>
<li><code class="docutils literal"><span class="pre">all_child</span></code> (record in all the child processes);</li>
<li><code class="docutils literal"><span class="pre">all</span></code> (record in all the processes).</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="optional-fields">
<h3>Optional Fields<a class="headerlink" href="#optional-fields" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">cpp_guard</span></code>: A string that gets inserted as an <code class="docutils literal"><span class="pre">#ifdef</span></code> directive around the automatically generated C++ declaration. This is typically used for platform-specific scalars, e.g. <code class="docutils literal"><span class="pre">ANDROID</span></code>.</li>
<li><code class="docutils literal"><span class="pre">release_channel_collection</span></code>: This can be either <code class="docutils literal"><span class="pre">opt-in</span></code> (default) or <code class="docutils literal"><span class="pre">opt-out</span></code>. With the former the scalar is submitted by default on pre-release channels, unless the user has opted out. With the latter the scalar is submitted by default on release and pre-release channels, unless the user has opted out.</li>
<li><code class="docutils literal"><span class="pre">keyed</span></code>: A boolean that determines whether this is a keyed scalar. It defaults to <code class="docutils literal"><span class="pre">False</span></code>.</li>
</ul>
</div>
<div class="section" id="string-type-restrictions">
<h3>String type restrictions<a class="headerlink" href="#string-type-restrictions" title="Permalink to this headline">¶</a></h3>
<p>To prevent abuses, the content of a string scalar is limited to 50 characters in length. Trying
to set a longer string will result in an error and no string being set.</p>
</div>
<div class="section" id="keyed-scalars">
<h3>Keyed Scalars<a class="headerlink" href="#keyed-scalars" title="Permalink to this headline">¶</a></h3>
<p>Keyed scalars are collections of one of the available scalar types, indexed by a string key that can contain UTF8 characters and cannot be longer than 70 characters. Keyed scalars can contain up to 100 keys. This scalar type is for example useful when you want to break down certain counts by a name, like how often searches happen with which search engine.</p>
<p>Keyed scalars should only be used if the set of keys are not known beforehand. If the keys are from a known set of strings, other options are preferred if suitable, like categorical histograms or splitting measurements up into separate scalars.</p>
</div>
<div class="section" id="multiple-processes-caveats">
<h3>Multiple processes caveats<a class="headerlink" href="#multiple-processes-caveats" title="Permalink to this headline">¶</a></h3>
<p>When recording data in different processes of the same type (e.g. multiple content processes), the user is responsible for preventing races between the operations on the scalars.
Races can happen because scalar changes are sent from each child process to the parent process, and then merged into the final storage location. Since there’s no synchronization between the processes, operations like <code class="docutils literal"><span class="pre">setMaximum</span></code> can potentially produce different results if sent from more than one child process.</p>
</div>
</div>
<div class="section" id="the-processor-scripts">
<h2>The processor scripts<a class="headerlink" href="#the-processor-scripts" title="Permalink to this headline">¶</a></h2>
<p>The scalar definition file is processed and checked for correctness at compile time. If it
conforms to the specification, the processor scripts generate two C++ headers files, included
by the Telemetry C++ core.</p>
<div class="section" id="gen-scalar-data-py">
<h3>gen_scalar_data.py<a class="headerlink" href="#gen-scalar-data-py" title="Permalink to this headline">¶</a></h3>
<p>This script is called by the build system to generate the <code class="docutils literal"><span class="pre">TelemetryScalarData.h</span></code> C++ header
file out of the scalar definitions.
This header file contains an array holding the scalar names and version strings, in addition
to an array of <code class="docutils literal"><span class="pre">ScalarInfo</span></code> structures representing all the scalars.</p>
</div>
<div class="section" id="gen-scalar-enum-py">
<h3>gen_scalar_enum.py<a class="headerlink" href="#gen-scalar-enum-py" title="Permalink to this headline">¶</a></h3>
<p>This script is called by the build system to generate the <code class="docutils literal"><span class="pre">TelemetryScalarEnums.h</span></code> C++ header
file out of the scalar definitions.
This header file contains an enum class with all the scalar identifiers used to access them
from code through the C++ API.</p>
</div>
</div>
<div class="section" id="adding-a-new-probe">
<h2>Adding a new probe<a class="headerlink" href="#adding-a-new-probe" title="Permalink to this headline">¶</a></h2>
<p>Making a scalar measurement is a two step process:</p>
<ol class="arabic simple">
<li>add the probe definition to the scalar registry;</li>
<li>record into the scalar using the API.</li>
</ol>
<div class="section" id="registering-the-scalar">
<h3>Registering the scalar<a class="headerlink" href="#registering-the-scalar" title="Permalink to this headline">¶</a></h3>
<p>Let’s start by registering two probes in the <a class="reference external" href="https://dxr.mozilla.org/mozilla-central/source/toolkit/components/telemetry/Scalars.yaml">Scalars.yaml</a> definition file: a simple boolean scalar and a keyed unsigned scalar.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="c1"># The following section contains the demo scalars.</span>
<span class="l l-Scalar l-Scalar-Plain">profile</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">was_reset</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">bug_numbers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1301364</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">True if the profile was reset.</span>
    <span class="l l-Scalar l-Scalar-Plain">expires</span><span class="p p-Indicator">:</span> <span class="s">&quot;60&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">boolean</span>
    <span class="l l-Scalar l-Scalar-Plain">notification_emails</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">change-me@allizom.com</span>
    <span class="l l-Scalar l-Scalar-Plain">release_channel_collection</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">opt-out</span>
    <span class="l l-Scalar l-Scalar-Plain">record_in_processes</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="s">&#39;main&#39;</span>

<span class="l l-Scalar l-Scalar-Plain">ui</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">download_button_activated</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">bug_numbers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1301364</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">&gt;</span>
      <span class="no">The number of times the download button was activated, per</span>
      <span class="no">input type (e.g. &#39;mouse_click&#39;, &#39;touchscreen&#39;, ...).</span>
    <span class="l l-Scalar l-Scalar-Plain">expires</span><span class="p p-Indicator">:</span> <span class="s">&quot;60&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">uint</span>
    <span class="l l-Scalar l-Scalar-Plain">keyed</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">notification_emails</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">change-me@allizom.com</span>
    <span class="l l-Scalar l-Scalar-Plain">release_channel_collection</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">opt-in</span>
    <span class="l l-Scalar l-Scalar-Plain">record_in_processes</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="s">&#39;main&#39;</span>
</pre></div>
</div>
<p>These two scalars have different collection policies and are both constrained to recording only in the main process.
For example, the <code class="docutils literal"><span class="pre">ui.download_button_activated</span></code> can be recorded only by users on running pre-release builds of Firefox.</p>
</div>
<div class="section" id="using-the-js-api">
<h3>Using the JS API<a class="headerlink" href="#using-the-js-api" title="Permalink to this headline">¶</a></h3>
<p>Changing the demo scalars from privileged JavaScript code is straightforward:</p>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="c1">// Set the scalar value: trying to use a non-boolean value doesn&#39;t throw</span>
<span class="c1">// but rather prints a warning to the browser console</span>
<span class="nx">Services</span><span class="p">.</span><span class="nx">telemetry</span><span class="p">.</span><span class="nx">scalarSet</span><span class="p">(</span><span class="s2">&quot;profile.was_reset&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="c1">// This call increments the value stored in &quot;mouse_click&quot; within the</span>
<span class="c1">// &quot;ui.download_button_activated&quot; scalar, by 1.</span>
<span class="nx">Services</span><span class="p">.</span><span class="nx">telemetry</span><span class="p">.</span><span class="nx">keyedScalarAdd</span><span class="p">(</span><span class="s2">&quot;ui.download_button_activated&quot;</span><span class="p">,</span> <span class="s2">&quot;mouse_click&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>More usage examples can be found in the tests covering the <a class="reference external" href="https://dxr.mozilla.org/mozilla-central/source/toolkit/components/telemetry/tests/unit/test_TelemetryScalars.js">JS Scalars API</a> and <a class="reference external" href="https://dxr.mozilla.org/mozilla-central/source/toolkit/components/telemetry/tests/unit/test_ChildScalars.js">child processes scalars</a>.</p>
</div>
<div class="section" id="using-the-c-api">
<h3>Using the C++ API<a class="headerlink" href="#using-the-c-api" title="Permalink to this headline">¶</a></h3>
<p>Native code can take advantage of Scalars as well, by including the <code class="docutils literal"><span class="pre">Telemetry.h</span></code> header file.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">Telemetry</span><span class="o">::</span><span class="n">ScalarSet</span><span class="p">(</span><span class="n">Telemetry</span><span class="o">::</span><span class="n">ScalarID</span><span class="o">::</span><span class="n">PROFILE_WAS_RESET</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>

<span class="n">Telemetry</span><span class="o">::</span><span class="n">ScalarAdd</span><span class="p">(</span><span class="n">Telemetry</span><span class="o">::</span><span class="n">ScalarID</span><span class="o">::</span><span class="n">UI_DOWNLOAD_BUTTON_ACTIVATED</span><span class="p">,</span>
                     <span class="n">NS_LITERAL_STRING</span><span class="p">(</span><span class="s">&quot;touchscreen&quot;</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">ScalarID</span></code> enum is automatically generated by the build process, with an example being available <a class="reference external" href="https://dxr.mozilla.org/mozilla-central/search?q=path%3ATelemetryScalarEnums.h&amp;redirect=false">here</a> .</p>
<p>Other examples can be found in the <a class="reference external" href="https://dxr.mozilla.org/mozilla-central/source/toolkit/components/telemetry/tests/gtest/TestScalars.cpp">test coverage</a> for the scalars C++ API.</p>
</div>
</div>
<div class="section" id="version-history">
<h2>Version History<a class="headerlink" href="#version-history" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Firefox 50: Initial scalar support (<a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1276195">bug 1276195</a>).</li>
<li>Firefox 51: Added keyed scalars (<a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1277806">bug 1277806</a>).</li>
<li>Firefox 53: Added child process scalars (<a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1278556">bug 1278556</a>).</li>
<li>Firefox 58<ul>
<li>Added support for recording new scalars from add-ons (<a class="reference external" href="bughttps://bugzilla.mozilla.org/show_bug.cgi?id=1393801">bug 1393801</a>).</li>
<li>Ignore re-registering existing scalars for a category instead of failing (<a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1409323">bug 1409323</a>).</li>
</ul>
</li>
</ul>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="histograms.html" class="btn btn-neutral float-right" title="Histograms" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Data collection" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright .

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../../',
            VERSION:'59.0a1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>