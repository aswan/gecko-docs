

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Caches &mdash; Mozilla Source Tree Docs 59.0a1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Mozilla Source Tree Docs 59.0a1 documentation" href="../../index.html"/>
        <link rel="up" title="Reference" href="reference.html"/>
        <link rel="next" title="geckodriver" href="../../testing/geckodriver/geckodriver/index.html"/>
        <link rel="prev" title="Task Attributes" href="attributes.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Mozilla Source Tree Docs
          

          
          </a>

          
            
            
              <div class="version">
                59.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../browser/base/sslerrorreport/index.html">SSL Error Reporting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../browser/browser/index.html">Firefox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../browser/experiments/experiments/index.html">Telemetry Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../build/buildsystem/index.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dom/bindings/webidl/index.html">WebIDL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gfx/gfx/index.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mobile/android/fennec/index.html">Firefox for Android</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mobile/android/fennec/index.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mozbase/index.html">mozbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mozbase/index.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/mach/index.html">mach</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">TaskCluster Task-Graph Generation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="taskgraph.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="mach.html">Mach commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="loading.html">Loading Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="transforms.html">Transforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimization.html">Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker-images.html">Docker Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="cron.html">Periodic Taskgraphs</a></li>
<li class="toctree-l2"><a class="reference internal" href="try.html">Try</a></li>
<li class="toctree-l2"><a class="reference internal" href="actions.html">Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="how-tos.html">How Tos</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="reference.html">Reference</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="kinds.html">Task Kinds</a></li>
<li class="toctree-l3"><a class="reference internal" href="parameters.html">Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="attributes.html">Task Attributes</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Caches</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#caches-and-run-task">Caches and <code class="docutils literal"><span class="pre">run-task</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#common-caches">Common Caches</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/geckodriver/geckodriver/index.html">geckodriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testing/marionette/marionette/index.html">Marionette</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/components/crashes/crash-manager/index.html">Crash Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/components/extensions/webextensions/index.html">WebExtensions API Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/components/payments/docs/index.html">WebPayments UI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/components/telemetry/telemetry/index.html">Telemetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/components/url-classifier/url-classifier/index.html">URL Classifier</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/crashreporter/crashreporter/index.html">Crash Reporter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/modules/subprocess/toolkit_modules/subprocess/index.html">Supbrocess Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/modules/toolkit_modules/index.html">Toolkit modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../toolkit/mozapps/extensions/addon-manager/index.html">Add-on Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/compare-locales/index.html">Localization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/lint/index.html">Linting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/lint/index.html#indices-and-tables">Indices and tables</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../python/mach.html">mach package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/mozbuild.html">mozbuild package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/mozlint.html">mozlint package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/mozpack.html">mozpack package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/mozversioncontrol.html">mozversioncontrol package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/mozwebidlcodegen.html">mozwebidlcodegen package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/taskgraph.html">taskgraph package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Mozilla Source Tree Docs</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">TaskCluster Task-Graph Generation</a> &raquo;</li>
        
          <li><a href="reference.html">Reference</a> &raquo;</li>
        
      <li>Caches</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/taskcluster/taskcluster/caches.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="caches">
<h1>Caches<a class="headerlink" href="#caches" title="Permalink to this headline">¶</a></h1>
<p>There are various caches used by the in-tree tasks. This page attempts to
document them and their appropriate use.</p>
<p>Caches are essentially isolated filesystems that are persisted between
tasks. For example, if 2 tasks run on a worker - one after the other -
and both tasks request the same cache, the subsequent task will be
able to see files in the cache that were created by the first task.
It’s also worth noting that TaskCluster workers ensure a cache can only
be used by 1 task at a time. If a worker is simultaneously running
multiple tasks requesting the same named cache, the worker will
have multiple caches of the same name on the worker.</p>
<div class="section" id="caches-and-run-task">
<h2>Caches and <code class="docutils literal"><span class="pre">run-task</span></code><a class="headerlink" href="#caches-and-run-task" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">run-task</span></code> is our generic task wrapper script. It does common activities
like ensure a version control checkout is present.</p>
<p>One of the roles of <code class="docutils literal"><span class="pre">run-task</span></code> is to verify and sanitize caches.
It does this by storing state in a cache on its first use. If the recorded
<em>capabilities</em> of an existing cache don’t match expectations for the
current task, <code class="docutils literal"><span class="pre">run-task</span></code> bails. This ensures that caches are only
reused by tasks with similar execution <em>profiles</em>. This prevents
accidental cache use across incompatible tasks. It also allows run-task
to make assumptions about the state of caches, which can help avoid
costly operations.</p>
<p>In addition, the hash of <code class="docutils literal"><span class="pre">run-task</span></code> is used to derive the cache name.
So any time <code class="docutils literal"><span class="pre">run-task</span></code> changes, a new set of caches are used. This
ensures that any backwards incompatible changes or bug fixes to
<code class="docutils literal"><span class="pre">run-task</span></code> result in fresh caches.</p>
<p>Some caches are reserved for use with run-task. That property will be denoted
below.</p>
</div>
<div class="section" id="common-caches">
<h2>Common Caches<a class="headerlink" href="#common-caches" title="Permalink to this headline">¶</a></h2>
<div class="section" id="version-control-caches">
<h3>Version Control Caches<a class="headerlink" href="#version-control-caches" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">level-{{level}}-checkouts-{{hash}}</span></code></dt>
<dd><p class="first">This cache holds version control checkouts, each in a subdirectory named
after the repo (e.g., <code class="docutils literal"><span class="pre">gecko</span></code>).</p>
<p>Checkouts should be read-only. If a task needs to create new files from
content of a checkout, this content should be written in a separate
directory/cache (like a workspace).</p>
<p class="last">This cache name pattern is managed by <code class="docutils literal"><span class="pre">run-task</span></code> and must only be
used with <code class="docutils literal"><span class="pre">run-task</span></code>.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">level-{{level}}-checkouts-sparse-{{hash}}</span></code></dt>
<dd>This is like the above but is used when the checkout is sparse (contains
a subset of files).</dd>
<dt><code class="docutils literal"><span class="pre">level-{{level}}-checkouts-{{version}}</span></code> (deprecated)</dt>
<dd><p class="first">This cache holds version control checkouts, each in a subdirectory named
after the repo (e.g., <code class="docutils literal"><span class="pre">gecko</span></code>).</p>
<p>Checkouts should be read-only. If a task needs to create new files from
content of a checkout, this content should be written in a separate
directory/cache (like a workspace).</p>
<p>A <code class="docutils literal"><span class="pre">version</span></code> parameter appears in the cache name to allow
backwards-incompatible changes to the cache’s behavior.</p>
<p class="last">The <code class="docutils literal"><span class="pre">hg-store</span></code> contains a <cite>shared store &lt;https://www.mercurial-scm.org/wiki/ShareExtension&gt;</cite>
that is is used by <code class="docutils literal"><span class="pre">hg</span> <span class="pre">robustcheckout</span></code>. If you are using <code class="docutils literal"><span class="pre">run-task</span></code> you
should set the <code class="docutils literal"><span class="pre">HG_STORE_PATH</span></code> environment variable to point to this
directory. If you are using <code class="docutils literal"><span class="pre">hg</span> <span class="pre">robustcheckout</span></code>, pass this directory to the
<code class="docutils literal"><span class="pre">--sharebase</span></code> option.</p>
</dd>
</dl>
</div>
<div class="section" id="workspace-caches">
<h3>Workspace Caches<a class="headerlink" href="#workspace-caches" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">level-{{level}}-*-workspace</span></code></dt>
<dd>These caches (of various names typically ending with <code class="docutils literal"><span class="pre">workspace</span></code>)
contain state to be shared between task invocations. Use cases are
dependent on the task.</dd>
</dl>
</div>
<div class="section" id="other">
<h3>Other<a class="headerlink" href="#other" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><a href="#id1"><span class="problematic" id="id2">``</span></a>level-{{level}}-tooltool-cache-{{hash}}</dt>
<dd><p class="first">Tooltool invocations should use this cache. Tooltool will store files here
indexed by their hash.</p>
<p class="last">This cache name pattern is reserved for use with <code class="docutils literal"><span class="pre">run-task</span></code> and must only
be used by <code class="docutils literal"><span class="pre">run-task</span></code></p>
</dd>
<dt><code class="docutils literal"><span class="pre">tooltool-cache</span></code> (deprecated)</dt>
<dd>Legacy location for tooltool files. Use the per-level one instead.</dd>
</dl>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../testing/geckodriver/geckodriver/index.html" class="btn btn-neutral float-right" title="geckodriver" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="attributes.html" class="btn btn-neutral" title="Task Attributes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright .

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'59.0a1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>